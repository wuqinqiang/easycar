syntax = "proto3";

package proto;

option go_package = "/proto";

import "google/protobuf/empty.proto";


service EasyCar {
  rpc Begin(google.protobuf.Empty)returns(BeginResp){}
  rpc Register(RegisterReq)returns(RegisterResp){}
  rpc Commit(CommitReq)returns(CommitResp){}
  rpc Abort(AbortReq) returns(AbortResp){}
  rpc GetState(GetStateReq) returns(GetStateResp){}
}


enum Code {
  CODE_SUCCESS = 0;
  CODE_FAILED = 1;
}

message RegisterReq {

}
message RegisterResp {
  BaseResp common = 1;
}

message BaseResp {
  Code code = 1;
  string msg = 2;
}

// todo more
enum TransactionName {
  DEFAULT = 0;
  TCC = 1;
  SAGA = 2;
}


//todo more
enum GlobalState {
  GLOBAL_DEFAULT = 0;
  PREPARED = 1;
  SUBMITTED = 2;
  SUCCEED = 3;
  FAILED = 4;
  ABORT = 5;
}


//todo more
enum BranchState {
  BRANCH_DEFAULT = 0;
  BRANCH_READY = 1;
  BRANCH_SUCCEED = 2;
  BRANCH_FAILED = 3;
}



message BeginReq {
  TransactionName name = 1;
}

message BeginResp {
  BaseResp common = 1;
  message info{
    string GId = 1;
  }
  info data = 3;
}

message CommitReq {
  string GId = 1;
}
message CommitResp {
  BaseResp common = 1;
  message info{
    GlobalState state = 1;
  }
  info data = 2;
}


message AbortReq {
  string GId = 1;
}

message AbortResp {
  BaseResp common = 1;
}

message RollBackResp{
  BaseResp common = 1;
  message info{
    GlobalState state = 1;
  }
  info data = 2;
}

message GetStateReq {
  string GId = 1;
}

message GetStateResp {
  BaseResp common = 1;
}